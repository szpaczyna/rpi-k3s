{{- /* Transmission-specific services (keep as-is) */ -}}
{{- if .Values.transmission.enable }}
apiVersion: v1
kind: Service
metadata:
  name: transmission-http
  labels:
    app.kubernetes.io/name: transmission
spec:
  type: "{{ .Values.transmission.service.type }}"
  ports:
    - port: {{ .Values.transmission.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: transmission

---
apiVersion: v1
kind: Service
metadata:
  name: transmission-utptcp
  labels:
    app.kubernetes.io/name: transmission
  annotations:
    metallb.io/allow-shared-ip: "true"
spec:
  type: LoadBalancer
  loadBalancerIP: "{{ .Values.transmission.loadbalancer.ip }}"
  ports:
    - port: {{ .Values.transmission.loadbalancer.port }}
      targetPort: utptcp
      protocol: TCP
      name: utptcp
  selector:
    app.kubernetes.io/name: transmission

---
apiVersion: v1
kind: Service
metadata:
  name: transmission-utpudp
  labels:
    app.kubernetes.io/name: transmission
  annotations:
    metallb.io/allow-shared-ip: "true"
spec:
  type: LoadBalancer
  loadBalancerIP: "{{ .Values.transmission.loadbalancer.ip }}"
  ports:
    - port: {{ .Values.transmission.loadbalancer.port }}
      targetPort: utpudp
      protocol: UDP
      name: utpudp
  selector:
    app.kubernetes.io/name: transmission
{{- end }}

{{- /* Calibre web service (keep separate for host root path) */ -}}
{{- if .Values.calibreWeb.enable }}
---
apiVersion: v1
kind: Service
metadata:
  name: calibre-web
  labels:
    app.kubernetes.io/name: calibre-web
spec:
  type: ClusterIP
  ports:
    - name: calibre-web
      port: {{ .Values.calibreWeb.service.port }}
      protocol: TCP
      targetPort: calibre-web
  selector:
    app.kubernetes.io/name: calibre-web
{{- end }}

{{- /* Generic media services */ -}}
{{- range $name, $svc := .Values.media }}
  {{- if and $svc.enable (hasSuffix $name "arr") }}
---
apiVersion: v1
kind: Service
metadata:
  name: {{ $name }}
  labels:
    app.kubernetes.io/name: {{ $name }}
spec:
  type: {{ $svc.service.type | default "ClusterIP" }}
  ports:
    - port: {{ $svc.service.port }}
      targetPort: {{ $name }}
      protocol: TCP
      name: {{ $name }}
  selector:
    app.kubernetes.io/name: {{ $name }}
  {{- end }}
{{- end }}
