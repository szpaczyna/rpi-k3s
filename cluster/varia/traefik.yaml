---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: traefik
  namespace: kube-system
  labels:
    app.kubernetes.io/name: traefik
spec:
  chart: https://%{KUBERNETES_API}%/static/charts/traefik-1.81.0.tgz
  valuesContent: |-
    replicas: 3
    rbac:
      enabled: true
    ssl:
      enabled: true
      defaultCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZHekNDQkFPZ0F3SUJBZ0lTQk1jdjBYcHFzNGpFa2VLMXNHbHJyUjYyTUEwR0NTcUdTSWIzRFFFQkN3VUEKTURJeEN6QUpCZ05WQkFZVEFsVlRNUll3RkFZRFZRUUtFdzFNWlhRbmN5QkZibU55ZVhCME1Rc3dDUVlEVlFRRApFd0pTTXpBZUZ3MHlNVEF5TWpZeE16UTVOREphRncweU1UQTFNamN4TXpRNU5ESmFNQll4RkRBU0JnTlZCQU1NCkN5b3VjMmh3WVhFdWIzSm5NSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTRWU3MKK3o4MW9xWlpFYkd0T1BqZUhBeWszeFFRTUsyOVhNWjRWU2N2LzN6dllmSFhVSzZqNzNCdE9OMkxaM2NIMlg4WApkVWNEc0RrdE5scWtiQmJjZU5sWjFwMkc5K084OXNrSm5yTk8vVTFBZmhBU25mWDJ2eUFzbXhyemxYZGFCRFAwCmRIYTBveTlYZTBZZTRqYmZoVSt1cWpvN2UwM3NnU0FZR2x3cDFUZS9tTThqTDRrNTBLTHRIdVdGemFjTS9yRjMKb3BSNHpJTG9DNXJIaWZhdEhQRm8xdVdpMG9QdVR3Slh3cmxLMENpbVJYc3dhUWFRUkhSQ25NRTVVczA1ZlVqcQpIVmhmRllUUG01U0p2em1kNGZKY0VScXRoc2V3U2xUZ28vQ21kWEkwSWJLd2RoOVlUUElyYXZSeFFHcjFtZEErCm1kajFJNzdmL2Frd0ZqMnNid0lEQVFBQm80SUNSVENDQWtFd0RnWURWUjBQQVFIL0JBUURBZ1dnTUIwR0ExVWQKSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQU1CMEdBMVVkRGdRVwpCQlFFaEFmeGdOYVhQRFpkSEZtVUs5ZjlaVEVVMWpBZkJnTlZIU01FR0RBV2dCUVVMck1YdDFoV3k2NVFDVURtCkg2K2RpeFRDeGpCVkJnZ3JCZ0VGQlFjQkFRUkpNRWN3SVFZSUt3WUJCUVVITUFHR0ZXaDBkSEE2THk5eU15NXYKTG14bGJtTnlMbTl5WnpBaUJnZ3JCZ0VGQlFjd0FvWVdhSFIwY0RvdkwzSXpMbWt1YkdWdVkzSXViM0puTHpBVwpCZ05WSFJFRUR6QU5nZ3NxTG5Ob2NHRnhMbTl5WnpCTUJnTlZIU0FFUlRCRE1BZ0dCbWVCREFFQ0FUQTNCZ3NyCkJnRUVBWUxmRXdFQkFUQW9NQ1lHQ0NzR0FRVUZCd0lCRmhwb2RIUndPaTh2WTNCekxteGxkSE5sYm1OeWVYQjAKTG05eVp6Q0NBUU1HQ2lzR0FRUUIxbmtDQkFJRWdmUUVnZkVBN3dCMkFKUWd2QjZPMVkxc2lITWZnb3NpTEEzUgoyazFlYkUrVVBXSGJUaTlZVGFMQ0FBQUJkOTdSRzc0QUFBUURBRWN3UlFJZ0lVNGxNYmFHNDhVNFhjb1JWbW1PCjFkOS9JVTRtMDZEVGxsN1ZJVEZpc1dBQ0lRQ3lDZU9uSEFncDlSd3AzMnZheDBjYVdPN2pqRTdjTlBkd2pXZDIKYkI2eER3QjFBSDArOHZpUC80aFZhQ1RDd01xZVVvbDVLOFVPZUFsL0xtcVhhSmwrSXZEWEFBQUJkOTdSRyswQQpBQVFEQUVZd1JBSWdmcWtzYjNoYmR2SHE3eDY5UGNrVXMxSHNxbXozR0pucTVycmZ5VndEZ2xZQ0lDVEVuYUZ1CnpTY2ErdFZ6RmpERytEN0s1OFp6ZnBJRThrL1NFK3FXNWkxb01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ2kKdXFBalBvckUvZjYwMWVhYVBxWG9Wa3pPS0duazNoOWdBaWdwUWRQSXFFby8xU0hjY0ZnV3BQSzdaeVdvMVNnUAo4ejBUOWh0d1Z4UG5xd0xpTEVISXMzTjY3UDQwbW1iQWdxSS9mVy9aVjR5L29paGRRbFRRQ1JsTzE1SmRXQUtHCkJYUHhiK0NQRHBkaDAyM3BzM2h6ejVFbm4xbm12UmcxaHB5Wm5WSEhoWUdvZ0tWSHlidThCbU45ME5RdnV6UUYKNlNsZWxXRDZlSDZBWGwvQ0h1NmhkRlc0elZRZXNyY3F3a0lNbE9NS1NVRVNPejlRT0JncTRjejNIaVBsb01mQwpWU1RHL1VvMGF1MmJMdEFjbW5DcmMxRnN6bjJuUW5KaUJxK0N3cVZsUDhHekpOL1RBc1JGRGFPR2RjaExrbFpkCnVRaFFLb1hlLytxUDlHa3dsamhECi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVaVENDQTAyZ0F3SUJBZ0lRUUFGMUJJTVVwTWdoaklTcERCYk4zekFOQmdrcWhraUc5dzBCQVFzRkFEQS8KTVNRd0lnWURWUVFLRXh0RWFXZHBkR0ZzSUZOcFoyNWhkSFZ5WlNCVWNuVnpkQ0JEYnk0eEZ6QVZCZ05WQkFNVApEa1JUVkNCU2IyOTBJRU5CSUZnek1CNFhEVEl3TVRBd056RTVNakUwTUZvWERUSXhNRGt5T1RFNU1qRTBNRm93Ck1qRUxNQWtHQTFVRUJoTUNWVk14RmpBVUJnTlZCQW9URFV4bGRDZHpJRVZ1WTNKNWNIUXhDekFKQmdOVkJBTVQKQWxJek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdXdJVktNejJvSlRURHhMcwpqVldTdy9pQzhabW1la0tJcDEwbXFyVXJ1Y1ZNc2ErT2EvbDF5S1BYRDBlVUZGVTFWNHllcUtJNUdmV0NQRUtwClRtNzFPOE11MjQzQXNGenpXVGpuN2M5cDhGb0xHNzdBbENRbGgvbzNjYk1UNXh5czRadnYyK1E3UlZKRmxxbkIKVTg0MHlGTHV0YTd0ajk1Z2NPS2xWS3UyYlE2WHBVQTBheXZUdkdiclpqUjgrbXVMajFjcG1mZ3dGMTI2Y20vNwpnY1d0MG9aWVBSZkg1d203OFN2M2h0ekIybkZkMUVianpLMGx3WWk4WUdkMVpyUHhHUGVpWE9aVC96cUl0a2VsCi94TVk2cGdKZHorZFUvblBBZVgxcG5BWEZLOWpwUCtaczVPZDNGT25CdjVJaFIyaGFhNGxkYnNUekZJRDllMVIKb1l2YkZRSURBUUFCbzRJQmFEQ0NBV1F3RWdZRFZSMFRBUUgvQkFnd0JnRUIvd0lCQURBT0JnTlZIUThCQWY4RQpCQU1DQVlZd1N3WUlLd1lCQlFVSEFRRUVQekE5TURzR0NDc0dBUVVGQnpBQ2hpOW9kSFJ3T2k4dllYQndjeTVwClpHVnVkSEoxYzNRdVkyOXRMM0p2YjNSekwyUnpkSEp2YjNSallYZ3pMbkEzWXpBZkJnTlZIU01FR0RBV2dCVEUKcDdHa2V5eHgrdHZoUzVCMS84UVZZSVdKRURCVUJnTlZIU0FFVFRCTE1BZ0dCbWVCREFFQ0FUQS9CZ3NyQmdFRQpBWUxmRXdFQkFUQXdNQzRHQ0NzR0FRVUZCd0lCRmlKb2RIUndPaTh2WTNCekxuSnZiM1F0ZURFdWJHVjBjMlZ1ClkzSjVjSFF1YjNKbk1Ed0dBMVVkSHdRMU1ETXdNYUF2b0MyR0syaDBkSEE2THk5amNtd3VhV1JsYm5SeWRYTjAKTG1OdmJTOUVVMVJTVDA5VVEwRllNME5TVEM1amNtd3dIUVlEVlIwT0JCWUVGQlF1c3hlM1dGYkxybEFKUU9ZZgpyNTJMRk1MR01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFOQmdrcWhraUc5dzBCCkFRc0ZBQU9DQVFFQTJVemd5ZldFaURjeDI3c1Q0clA4aTJ0aUVteFl0MGwrUEFLM3FCOG9ZZXZPNEM1ejcwa0gKZWpXRUh4MnRhUERZL2xhQkwyMS9XS1p1TlRZUUhIUEQ1YjF0WGdIWGJuTDdLcUM0MDFkazVWdkNhZFRRc3ZkOApTOE1Yam9oeWM5ejkvRzI5NDhrTGptRTZGbGg5ZERZclZZQTl4Mk8raEVQR09hRU9hMWVlUHluQmdQYXl2VWZMCnFqQnN0ekxoV1ZRTEdBa1hYbU5zKzVablBCeHpESk9MeGhGMkpJYmVRQWNINUgwdFpyVWxvNVpZeU9xQTdzOXAKTzViODVvM0FNL09KK0NrdEZCUXRmdkJoY0pWZDl3dmx3UHNrK3V5T3kySEk3bU54S0tnc0JUdDM3NXRlQTJUdwpVZEhraFZOY3NBS1gxSDdHTk5MT0VBRGtzZDg2d3VvWHZnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
      defaultKey: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRGhWS3o3UHpXaXBsa1IKc2EwNCtONGNES1RmRkJBd3JiMWN4bmhWSnkvL2ZPOWg4ZGRRcnFQdmNHMDQzWXRuZHdmWmZ4ZDFSd093T1MwMgpXcVJzRnR4NDJWblduWWIzNDd6MnlRbWVzMDc5VFVCK0VCS2Q5ZmEvSUN5Ykd2T1ZkMW9FTS9SMGRyU2pMMWQ3ClJoN2lOdCtGVDY2cU9qdDdUZXlCSUJnYVhDblZONytZenlNdmlUblFvdTBlNVlYTnB3eitzWGVpbEhqTWd1Z0wKbXNlSjlxMGM4V2pXNWFMU2crNVBBbGZDdVVyUUtLWkZlekJwQnBCRWRFS2N3VGxTelRsOVNPb2RXRjhWaE0rYgpsSW0vT1ozaDhsd1JHcTJHeDdCS1ZPQ2o4S1oxY2pRaHNyQjJIMWhNOGl0cTlIRkFhdldaMEQ2WjJQVWp2dC85CnFUQVdQYXh2QWdNQkFBRUNnZ0VCQUtsWmdYU0hDaUdIRWpRSkxGNUFOSFl5VG90V1FlREVBeWpDQlZoQ1RvR2UKL1M3SW13R0piNjRaK2d5ZC9SS3kxQlJ6djBhbUs3QjdHRzdjYXV6TnRiK2g0ekk0VEdMc0oyMzJwQ05CTWlHUAp1T1BGNHFnVFh2SkFGU1l4ZUZhaVQrWU93aS94czB0ZDNrckk1WmN3bElkVjNya1RjUGI0RnNMcFF4UTBwa0FXCjczUFZadkhzdEtpdHBZQWdPWjJNTUtnS0ZFMVNnWUEyL2VFczQ4ZHc3ZW5ueVVvenoxYTVRN1ZVTno1a28wQUYKbERkTTlEYzNZYmtTUWRQdmRyQlAvMHhzMEl0UUhWbG1ndjNPVjNHSVVKTXBWeWRZRkFCRWJqbWxRWXNmN045UgpUc0ZTSGNzRXJxYTRkZE42YnJuTCtJc3UyVEZJNURzVHFydU1TVWVVOVNFQ2dZRUEvZ0pveE0wY2VNN3EvOHR0Ci81M3YrK2dlSjR1V1RIZitpa09yQThzUW94cEsyajV5a2NVZnFJY1lOTXpQVFk0YmVSdzlBWm9PNFBpcW1GTGYKZG5DL04wN3pMeWk5V0tkOW42NjRzazIreFkvYmNyaHBnNjUzRTFpc0xKZTF6Qzd1WWsxVExEbFEwUzQvenR6awpYTVB1bGtqbWxSNVdHSVhmaW9oc1J2NDV0UkVDZ1lFQTR4aTdUOGNvZzREZCtnSk14Q0xJN2VaNnpNamxxR0pXCjlnTmhoQjNzeUpYMzdWbWg5eXZseFJHQmJRbGREQUtYY3FySWRwcmtLSVRSdzJsN0ZuYlpSYWc5Zy95WE1rUjkKcDlsdkpzQnZla2FTaVVYOE9SNVR6K2VOZTd0RVU5ejIzcTM1bnIrOC9QaEZmanEvR1AzRGJMN1dLM0JJeGNJdApVOThpdmdkTFNYOENnWUFpVGdyK1FVRk9JNHZqWGdNT0diTjJqd083allPUDhrakRQWjVVRmRHNlpXdWtpL2lICkxWczROSDZWYXUrNFpxL1pMSElrekR5a0w1RkNuemFrMVZkTnpmRFQ5cW1UMXBNRnhPQVczSjhlS1c2VzBNY1gKVExHeVFEQ0ltVGlwU2RGU0gyVlRQSzVvZ2RtR1E1am4ybUpYazZMb2tyOUg4cFNkTGcySmpQNFlNUUtCZ0ZFMgpqZjM0dmg5UkhaRUQ4NG9NMm9oaGJUY0EvVWhiYXJmdCs1aXd6dlhvMDlJWXhOaE01WTIxTmZEVmNXWVRJekFKCnJVamxHWVQ0QXIvOFg5MW53VW1zNGRycW9QT0VGTi9LM1hvaFJYeVg4bDJQSHFVYW1HUjRiVnQ3Vy9NVnlWOVgKSGpiTVlQeWltTStNbUx5S083SVBDUzVkcUZpNG1WY3VMQkdETUVSbkFvR0JBTE5zUDdlWm9UaVEyT0Rta1c3VwptNmR3Y0Jpa3VCd2QydjM5VFJDWHpKVVF3dCsyOWZGSXN0emFyUDlkaHNNaFprbU9tRlhOOGFZRHhkMHNaYlpnCmh3SW5HLzBLblByUnFqR24yUFZ3RHcyVW8wWFJhQWNTVzE3ZUl3V0piRGZuN3JsRy9Ob2tqa3NPYW5sbTlkSFEKalpjTXdFWjZ0dFZIVUZSMWM4WG12aWk2Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
    metrics:
      prometheus:
        enabled: true
    kubernetes:
      ingressEndpoint:
        useDefaultPublishedService: true
    dashboard:
      enabled: true
      domain: traefik.k3s.shpaq.org
    deployment:
      labels:
        app.kubernetes.io/name: traefik
      podLabels:
        app.kubernetes.io/name: traefik
      podAnnotations:
        prometheus.io/path: /metrics
        prometheus.io/port: 9100
        prometheus.io/scrape: true
    serviceType: LoadBalancer
    loadBalancerIP: 10.1.0.30
    service:
      annotations:
          #metallb.universe.tf/address-pool: "address-pool-1"
          #metallb.universe.tf/allow-shared-ip: "true"
    image: "rancher/library-traefik"
    tolerations:
      - key: "CriticalAddonsOnly"
        operator: "Exists"
      - key: "node-role.kubernetes.io/master"
        operator: "Exists"
        effect: "NoSchedule"
    nodeSelector:
      kubernetes.io/role: worker
      kubernetes.io/os: linux
    resources:
      requests:
        cpu: 100m
        memory: 50Mi
    limits:
        cpu: 1000m
        memory: 128Mi
    podDisruptionBudget:
      minAvailable: 1
    autoscaling:
      minReplicas: 1
      maxReplicas: 4
      metrics:
      - type: Resource
        resource:
          name: cpu
          targetAverageUtilization: 60
      - type: Resource
        resource:
          name: memory
          targetAverageUtilization: 100
