---
# DEPRECATED: Consolidated into lint-all.yml
name: (Deprecated) Kubeconform
permissions:
  contents: read

on:
  workflow_dispatch: {}

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - name: Set up Helm
        uses: azure/setup-helm@v4
        with:
          version: v3.14.0
      - name: Render Helm charts
        run: |
          mkdir -p rendered
          for d in cluster/helm/*/; do
            chart="${d%/}"
            name=$(basename "$chart")
            echo "Rendering $name";
            helm dependency update "$chart" || true
            helm template "$name" "$chart" > "rendered/${name}.yaml"
          done
      - name: Run kubeconform on raw manifests and rendered charts
        uses: docker://ghcr.io/yannh/kubeconform:latest
        with:
          args: -strict -ignore-missing-schemas -schema-location default -summary rendered cluster/apps cluster/core
      - name: Show summary
        if: always()
        run: echo 'Kubeconform validation completed.'
