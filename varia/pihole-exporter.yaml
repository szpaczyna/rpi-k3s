---
# Source: pihole-exporter/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: pihole-exporter
  labels:
    app.kubernetes.io/name: pihole-exporter
    helm.sh/chart: pihole-exporter-1.1.1
    app.kubernetes.io/instance: pihole-exporter
    app.kubernetes.io/version: "0.0.9"
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  
  PIHOLE_PASSWORD:  "Y2hhbmdtZQ=="
  
  
  PIHOLE_APITOKEN:  "Y2hhbmdtZQ=="
---
# Source: pihole-exporter/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: pihole-exporter
  labels:
    app.kubernetes.io/name: pihole-exporter
    helm.sh/chart: pihole-exporter-1.1.1
    app.kubernetes.io/instance: pihole-exporter
    app.kubernetes.io/version: "0.0.9"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 9617
      targetPort: 9617
      protocol: TCP
      name: httpexporter
  selector:
    app.kubernetes.io/name: pihole-exporter
    app.kubernetes.io/instance: pihole-exporter
---
# Source: pihole-exporter/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: pihole-exporter
  labels:
    app.kubernetes.io/name: pihole-exporter
    helm.sh/chart: pihole-exporter-1.1.1
    app.kubernetes.io/instance: pihole-exporter
    app.kubernetes.io/version: "0.0.9"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: pihole-exporter
      app.kubernetes.io/instance: pihole-exporter
  template:
    metadata:
      labels:
        app.kubernetes.io/name: pihole-exporter
        app.kubernetes.io/instance: pihole-exporter
    spec:
      containers:
        - name: pihole-exporter
          image: "ekofr/pihole-exporter:0.0.9"
          imagePullPolicy: IfNotPresent
          env:
          - name: "INTERVAL"
            value: "30s"
          - name: "PIHOLE_HOSTNAME"
            value: "pihole.k3s.shpaq.org"
          - name: "PIHOLE_PORT"
            value: "80"
          envFrom:
            - secretRef:
                name: pihole-exporter
          ports:
          - name: httpexporter
            containerPort: 9617
            protocol: TCP
          livenessProbe:
            httpGet:
              path: /liveness
              port: 9617
          readinessProbe:
            httpGet:
              path: /readiness
              port: 9617
          resources:
            limits:
              cpu: 100m
              memory: 128Mi
            requests:
              cpu: 100m
              memory: 128Mi
---
# Source: pihole-exporter/templates/serviceMonitor.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    app: pihole-exporter
  name: pihole-exporter
  namespace: monitoring
spec:
  endpoints:
  - interval: 30s
    port: httpexporter
    relabelings:
    - action: replace
      regex: (.*)
      replacement: $1
      sourceLabels:
      - __meta_kubernetes_pod_node_name
      targetLabel: instance
    scheme: http
  jobLabel: pihole-exporter-exporter
  namespaceSelector:
    matchNames:
    - pihole
  selector:
    matchLabels:
      app: pihole-exporter
---
# Source: pihole-exporter/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "pihole-exporter-test-connection"
  labels:
    app.kubernetes.io/name: pihole-exporter
    helm.sh/chart: pihole-exporter-1.1.1
    app.kubernetes.io/instance: pihole-exporter
    app.kubernetes.io/version: "0.0.9"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args:  ['pihole-exporter:9617']
  restartPolicy: Never
