apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: traefik
  namespace: kube-system
spec:
  chart: https://%{KUBERNETES_API}%/static/charts/traefik-1.81.0.tgz
  valuesContent: |-
    replicas: 3
    rbac:
      enabled: true
    ssl:
      enabled: true
      defaultCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZVRENDQkRpZ0F3SUJBZ0lTQk9nOVFnVzI0YWhVb1JUeVo2cFNobWhBTUEwR0NTcUdTSWIzRFFFQkN3VUEKTUVveEN6QUpCZ05WQkFZVEFsVlRNUll3RkFZRFZRUUtFdzFNWlhRbmN5QkZibU55ZVhCME1TTXdJUVlEVlFRRApFeHBNWlhRbmN5QkZibU55ZVhCMElFRjFkR2h2Y21sMGVTQllNekFlRncweU1ERXdNall4TXpRNU16aGFGdzB5Ck1UQXhNalF4TXpRNU16aGFNQll4RkRBU0JnTlZCQU1NQ3lvdWMyaHdZWEV1YjNKbk1JSUJJakFOQmdrcWhraUcKOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXhHMDB6RzR4Slp6Mm5Qc1l3Z2JkN2plU2MxLytyK2tKNDFIZgpTbS9tUlU5MkpIdkJDTmFFMGJidzFPOERnNGM1OWUxMGhtV1JkbndNV3FtZW1lTHVtakVWZXlZRjFuRGJkTHJ0CnpSTXBJR0FhNVlNZS9zdi9wRlU5WDdXRkZKQjJhV1hqbSsyOG15NW5PVzFQZ3Y1K3Awc1JQYmdISDBHdjl2SlkKTzVRODRrOXBJbkNHeGlrR3BZSTNiWHhoWjRpSkJiN1B6cUIycHhCS3JZYVhjbFg5dTRiQm9ZVjVSOXBwTnBNQgpoQngwVFJMQmRKWGxraUdHK3lJcEdRQmlKbWgwVUNxRlNaOEs5d0dFQWo5RWJvNkEzMURpVlkvVkltWHR4UVN2CnBoTUlCNjRJTDdkZFY1VnVCSTdtS0Y1RnpkL1FEQWpJdndqT1M4bmNRWUZ3OHBGbUJRSURBUUFCbzRJQ1lqQ0MKQWw0d0RnWURWUjBQQVFIL0JBUURBZ1dnTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQkJnZ3JCZ0VGQlFjRApBakFNQmdOVkhSTUJBZjhFQWpBQU1CMEdBMVVkRGdRV0JCU2tHM09rb0pTT3RGazZPeTFlQ0JwSDRGYlUwekFmCkJnTlZIU01FR0RBV2dCU29TbXBqQkgzZHV1YlJPYmVtUldYdjg2anNvVEJ2QmdnckJnRUZCUWNCQVFSak1HRXcKTGdZSUt3WUJCUVVITUFHR0ltaDBkSEE2THk5dlkzTndMbWx1ZEMxNE15NXNaWFJ6Wlc1amNubHdkQzV2Y21jdwpMd1lJS3dZQkJRVUhNQUtHSTJoMGRIQTZMeTlqWlhKMExtbHVkQzE0TXk1c1pYUnpaVzVqY25sd2RDNXZjbWN2Ck1CWUdBMVVkRVFRUE1BMkNDeW91YzJod1lYRXViM0puTUV3R0ExVWRJQVJGTUVNd0NBWUdaNEVNQVFJQk1EY0cKQ3lzR0FRUUJndDhUQVFFQk1DZ3dKZ1lJS3dZQkJRVUhBZ0VXR21oMGRIQTZMeTlqY0hNdWJHVjBjMlZ1WTNKNQpjSFF1YjNKbk1JSUJCZ1lLS3dZQkJBSFdlUUlFQWdTQjl3U0I5QUR5QUhjQWxDQzhIbzdWald5SWN4K0NpeUlzCkRkSGFUVjVzVDVROVlkdE9MMWhOb3NJQUFBRjFaV0xhT0FBQUJBTUFTREJHQWlFQTM0SG44TUp4K0JaY1V3TDcKRk9yK0pINHcxSHdLcGpZWENlQU5aSkJ2d25FQ0lRRGZZMzZYbysyY1VLQlh5ZmE4RXllN1dvOXFFOHB0cTN6dwp1YzdVdVNXRmlBQjNBUFpjbEMvUmR6QWlGRlFZQ0RDVVZvN2pUUk1aTTcvZkRDOGdDOHhPOFdUakFBQUJkV1ZpCjJqRUFBQVFEQUVnd1JnSWhBSUhQQXFabXprTWVlQWpmTFlQV0FCUCs1bnpwV3o0VlMzOEZKUDVwOFdHekFpRUEKc2kyYk11Q1BzMURRTG9qcjJIa0pOdlgrRWtxMEg1NHVIZVZQRHhTM01Fa3dEUVlKS29aSWh2Y05BUUVMQlFBRApnZ0VCQUZDY3pobXdlNGF0T3dQdFI2ZzQ3Rjl2ZFJPWDM0dTBtRnNRUEQvamhGaGlaNWhnU0VrZVRVMEhGc2N1CnZoSUhhTlBMd2tHaGpBK3JBcFVWSnpYbUNmSUxaMWlRd1V5Z1d5NHQveU1CclNnMDVMVVc2UVQ1RFZ3WVBnbDcKeGFBaEZCdUFoSHlPTTlHWFltdkp3TDBiYXRaTTJiSEQyUXBwTkk2SEw2d1J3MnpiL1c2V2VZbWFnVC9jWis0UgpSOUU2MTRybjF2bUZ5VkJMdWZOTFNTTUllUU5nZldLNW1uWWJuOU5oZGNGYUtBeVk1ZHJCcEY3b3NwVXRZMG1TCjlabTFkLzI4Si84RWk5MGd6QW9ub1dZN1Vxd3REMVlXSzFUNTQzZGg2a1g4S05MeUNtV0NJdUZkcldhYk9WU2sKNmtXelRxMms0bERUSUNMYzd3TlZrLzZCNEJJPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlFa2pDQ0EzcWdBd0lCQWdJUUNnRkJRZ0FBQVZPRmMyb0xoZXluQ0RBTkJna3Foa2lHOXcwQkFRc0ZBREEvCk1TUXdJZ1lEVlFRS0V4dEVhV2RwZEdGc0lGTnBaMjVoZEhWeVpTQlVjblZ6ZENCRGJ5NHhGekFWQmdOVkJBTVQKRGtSVFZDQlNiMjkwSUVOQklGZ3pNQjRYRFRFMk1ETXhOekUyTkRBME5sb1hEVEl4TURNeE56RTJOREEwTmxvdwpTakVMTUFrR0ExVUVCaE1DVlZNeEZqQVVCZ05WQkFvVERVeGxkQ2R6SUVWdVkzSjVjSFF4SXpBaEJnTlZCQU1UCkdreGxkQ2R6SUVWdVkzSjVjSFFnUVhWMGFHOXlhWFI1SUZnek1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0MKQVE4QU1JSUJDZ0tDQVFFQW5OTU04RnJsTGtlM2NsMDNnN05vWXpEcTF6VW1HU1hodmI0MThYQ1NMN2U0UzBFRgpxNm1lTlFoWTdMRXF4R2lIQzZQamRlVG04NmRpY2JwNWdXQWYxNUdhbi9QUWVHZHh5R2tPbFpIUC91YVo2V0E4ClNNeCt5azEzRWlTZFJ4dGE2N25zSGpjQUhKeXNlNmNGNnM1SzY3MUI1VGFZdWN2OWJUeVdhTjhqS2tLUURJWjAKWjhoL3BacTRVbUVVRXo5bDZZS0h5OXY2RGxiMmhvbnpoVCtYaHErdzNCcnZhdzJWRm4zRUs2QmxzcGtFTm5XQQphNnhLOHh1UVNYZ3ZvcFpQS2lBbEtRVEdkTURRTWMyUE1UaVZGcnFvTTdoRDhiRWZ3ekIvb25reEV6MHROdmpqCi9QSXphcms1TWNXdnhJME5IV1FXTTZyNmhDbTIxQXZBMkgzRGt3SURBUUFCbzRJQmZUQ0NBWGt3RWdZRFZSMFQKQVFIL0JBZ3dCZ0VCL3dJQkFEQU9CZ05WSFE4QkFmOEVCQU1DQVlZd2Z3WUlLd1lCQlFVSEFRRUVjekJ4TURJRwpDQ3NHQVFVRkJ6QUJoaVpvZEhSd09pOHZhWE55Wnk1MGNuVnpkR2xrTG05amMzQXVhV1JsYm5SeWRYTjBMbU52CmJUQTdCZ2dyQmdFRkJRY3dBb1l2YUhSMGNEb3ZMMkZ3Y0hNdWFXUmxiblJ5ZFhOMExtTnZiUzl5YjI5MGN5OWsKYzNSeWIyOTBZMkY0TXk1d04yTXdId1lEVlIwakJCZ3dGb0FVeEtleHBIc3NjZnJiNFV1UWRmL0VGV0NGaVJBdwpWQVlEVlIwZ0JFMHdTekFJQmdabmdRd0JBZ0V3UHdZTEt3WUJCQUdDM3hNQkFRRXdNREF1QmdnckJnRUZCUWNDCkFSWWlhSFIwY0RvdkwyTndjeTV5YjI5MExYZ3hMbXhsZEhObGJtTnllWEIwTG05eVp6QThCZ05WSFI4RU5UQXoKTURHZ0w2QXRoaXRvZEhSd09pOHZZM0pzTG1sa1pXNTBjblZ6ZEM1amIyMHZSRk5VVWs5UFZFTkJXRE5EVWt3dQpZM0pzTUIwR0ExVWREZ1FXQkJTb1NtcGpCSDNkdXViUk9iZW1SV1h2ODZqc29UQU5CZ2txaGtpRzl3MEJBUXNGCkFBT0NBUUVBM1RQWEVmTmpXRGpkR0JYN0NWVytkbGE1Y0VpbGFVY25lOElrQ0pMeFdoOUtFaWszSkhSUkhHSm8KdU0yVmNHZmw5NlM4VGloUnpadm9yb2VkNnRpNldxRUJtdHp3M1dvZGF0ZytWeU9lcGg0RVlwci8xd1hLdHg4Lwp3QXBJdkpTd3RtVmk0TUZVNWFNcXJTREU2ZWE3M01qMnRjTXlvNWpNZDZqbWVXVUhLOHNvL2pvV1VvSE9VZ3d1Clg0UG8xUVl6KzNkc3prRHFNcDRma2x4QndYUnNXMTBLWHpQTVRaK3NPUEF2ZXl4aW5kbWprVzhsR3krUXNSbEcKUGZaK0c2WjZoN21qZW0wWStpV2xrWWNWNFBJV0wxaXdCaThzYUNiR1M1ak4ycDhNK1grUTdVTktFa1JPYjNONgpLT3FrcW01N1RIMkgzZURKQWtTbmg2L0RORnUwUWc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
      defaultKey: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV3QUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktvd2dnU21BZ0VBQW9JQkFRREViVFRNYmpFbG5QYWMKK3hqQ0J0M3VONUp6WC82djZRbmpVZDlLYitaRlQzWWtlOEVJMW9UUnR2RFU3d09EaHpuMTdYU0daWkYyZkF4YQpxWjZaNHU2YU1SVjdKZ1hXY050MHV1M05FeWtnWUJybGd4Nyt5LytrVlQxZnRZVVVrSFpwWmVPYjdieWJMbWM1CmJVK0MvbjZuU3hFOXVBY2ZRYS8yOGxnN2xEemlUMmtpY0liR0tRYWxnamR0ZkdGbmlJa0Z2cy9Pb0hhbkVFcXQKaHBkeVZmMjdoc0doaFhsSDJtazJrd0dFSEhSTkVzRjBsZVdTSVliN0lpa1pBR0ltYUhSUUtvVkpud3IzQVlRQwpQMFJ1am9EZlVPSlZqOVVpWmUzRkJLK21Fd2dIcmdndnQxMVhsVzRFanVZb1hrWE4zOUFNQ01pL0NNNUx5ZHhCCmdYRHlrV1lGQWdNQkFBRUNnZ0VCQUtDdDNLVGw5dG9YM2p4bndzYmxLeUkwMzEzMXhyZExZRVZOc2VTSVNNdWwKeHJUdGJ1aTE0b3hTcEFyclFlcVQ4YnZVOUo4RDhzd0RpVytZbFI2NDNnblA0UXlOKy9TQStXUXhqVmxXTlN4QQpzWC9SbE1kRlJPZSt1cWZTS3Z5NWQ4T2NEMlo4UU82SU5QUnJFTUhOUVBuRWxHUHlhQkVQZ012M1RtbmVSemV2CjR2aXk5elVVVGFDeGcvNmRVeitzc3ZEdFM0VkdZcGJFUGhSWGFDMzJ2UUFhcERHM1JDbTkxUjNUK3QyQlMzaWEKdzNIMG56dWExUnB5ZFp4eWpGK1daT1RocFNZeXF5Vy9XMGViVnhKbTAzVUZuZGxlVTcxQXgyaXBXWWFrWldTdgpoYVQyeVF0bHZxdDBzcVFGQTJuYmo3a2VLaTYycTg3ZVdtMFM3aTR3VXJrQ2dZRUE1Mm50WlBkbnVzUXk1YVErCm45cVdXN3BhZ2NCMHhMVXlJd21JV08yK2MzOHhPTzlqa2Y4MDRmbE9SOE5LUytCWkdPckc3VWlHeVFydm9yNk0KNnhQUGRmdU1RWlk4M2xRcTRqTmVONW9IeWhyNS9YRmdnTnNCMWwxSDIyQmE2ZTdGSE8xMm9aWnVXSk91ZWNPdApXWGMrd3EvdGxCeHJrSnpFdGZyWjJGcGsyb2NDZ1lFQTJVdXZZVGp5N1QvYW1aMU5oa2FScGNRSU5TeDNGa2t6CjU0UWJTMUdNeUJTV09qTHNSTWNtNTNzY3F1eCtrVkZmSVJ3QnJWZ1FSRGljYTRXU0VnYzF0dFJwQ2lRUGh4L3IKR0FKd1pqUmdCcFN5VmVnZzNWSUVwb3BrZ1hOb3NoL05CN0tmR2ZnSkRvb3R5QnBhSEx4blZ6MG5YZDZ4SzVaMwpFaHV3czRNRzRoTUNnWUVBZ3htM3ErT2RtR2xlakVxb1Q5ZCtKeWxEN1E0akdPMnVJYnRjeTBTbENMbWVJU3M5CnRaQm5YVDNuNHkvMy8xUnlKWE9jandEdm15WGU3TXdXK1hhWHFiZUFsZ2VQSkVWNnBmdUQvT3YrVGJsS3R4SnMKSVpQeFRvZzZGVVpaT3Y1U0hUbEtZL0RkUXNFbnIwUDBDU05OSXU2WUliaVlGNjA0cEFBaE9qaTd1akVDZ1lFQQprd1pCd1IrZVJ1YllpdTNEUWFKSDlBZ2lvWS9YZDgzSi85RUVBcjlINlN6OHhKNGwvUmRlL0dyeFo3a2lua0tYCmdqaUg3ZmpTOE1YNUdFdEZIVXVoalhaRktDWmtGMEtDZURsV1FlRVlRL3VpZXJ2WVdNZWcrK3BSdk1FUXlzejMKbGtqR20vU1dkQzhNY1FOYmkydnk1RFV0aUxjZjIyVXdaYUUwdXhGaHU5OENnWUVBMGFzRWJTZWFBMEJKd29hNApPdXRlUlRiNlAxbXJRZk94L3hSZE9xMDFaMFc2VFJHOVQyRkpjWjQ2YlBKaVVRRWRwZ2gzdHlkNmErNFVFYUJyClk3Q2lVSEdQM2xoejJKYlIrMVFBQVVEU2c4cHNZbWFNRUVRb05uaWRFRzQzTVhsWjAveUFLOENRT01hVlFabkYKazJ0ZEo3aWxxek1hUzBNWUxMWWprODBQNVNNPQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==
    metrics:
      prometheus:
        enabled: true
    kubernetes:
      ingressEndpoint:
        useDefaultPublishedService: true
    dashboard:
      enabled: true
      domain: traefik.k3s.shpaq.org
    deployment:
      labels:
        k8s-app: traefik
      podLabels:
        k8s-app: traefik        
      podAnnotations:
        prometheus.io/path: /metrics
        prometheus.io/port: 9100
        prometheus.io/scrape: true
    serviceType: LoadBalancer
    service:
      annotations:
        metallb.universe.tf/address-pool: "address-pool-1"
        metallb.universe.tf/allow-shared-ip: "true"
    image: "rancher/library-traefik"
    tolerations:
      - key: "CriticalAddonsOnly"
        operator: "Exists"
      - key: "node-role.kubernetes.io/master"
        operator: "Exists"
        effect: "NoSchedule"
    nodeSelector:
      kubernetes.io/role: worker
      kubernetes.io/os: linux
    podDisruptionBudget:                                                                                                                                   
      minAvailable: 1
    autoscaling:                                                                                                                                             
      minReplicas: 1                                                                                                                                         
      maxReplicas: 4                                                                                                                                        
      metrics:                                                                                                                                               
      - type: Resource                                                                                                                                       
        resource:                                                                                                                                            
          name: cpu                                                                                                                                          
          targetAverageUtilization: 60                                                                                                                       
      - type: Resource                                                                                                                                       
        resource:                                                                                                                                            
          name: memory                                                                                                                                       
          targetAverageUtilization: 60
